{% extends 'base.html' %}
{% block content %}
<style>
  body {
    overflow-x: hidden;
  }
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 280px;
    background: #1976d2;
    border-right: 1px solid #1565c0;
    z-index: 2000;
    padding-top: 1rem;
    transition: width 0.3s cubic-bezier(.4,0,.2,1), transform 0.3s cubic-bezier(.4,0,.2,1);
    display: flex;
    flex-direction: column;
  }
  .sidebar.collapsed {
    width: 60px;
  }
  .sidebar-header {
    margin-bottom: 2rem;
    transition: opacity 0.3s;
    white-space: nowrap;
  }
  .sidebar.collapsed .sidebar-header .fs-4,
  .sidebar.collapsed .sidebar-header .text-muted {
    opacity: 0;
    pointer-events: none;
  }
  .main-content {
    margin-left: 280px;
    padding: 2rem 2rem 2rem 2rem;
    transition: margin-left 0.3s cubic-bezier(.4,0,.2,1);
  }
  .sidebar.collapsed ~ .main-content {
    margin-left: 60px;
  }
  .main-content.full {
    margin-left: 60px;
  }
  .sidebar .nav {
    flex-direction: column;
    height: 100%;
    display: flex;
  }
  .sidebar .nav-item {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
  }
  .sidebar .nav-link {
    display: flex;
    align-items: center;
    width: 100%;
    color: #fff !important;
    background: transparent;
    border-radius: 0.5rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    transition: background 0.2s, box-shadow 0.2s, color 0.2s, padding 0.3s;
    padding: 0.75rem 1rem;
  }
  .sidebar .nav-link .menu-icon {
    min-width: 28px;
    text-align: center;
    display: inline-block;
    font-size: 1.3rem;
  }
  .sidebar .nav-link .menu-label {
    margin-left: 12px;
    white-space: nowrap;
    transition: opacity 0.3s, width 0.3s;
    opacity: 1;
    width: auto;
    display: inline-block;
  }
  .sidebar.collapsed .nav-link .menu-label {
    opacity: 0;
    width: 0;
    pointer-events: none;
  }
  .sidebar .nav-link.active, .sidebar .nav-link:focus, .sidebar .nav-link:hover {
    background: rgba(66, 165, 245, 0.25);
    color: #fff !important;
    box-shadow: 0 2px 8px rgba(33,150,243,0.10);
  }
  .sidebar .nav-link.text-danger {
    color: #fff !important;
  }
  .hamburger {
    position: fixed;
    top: 18px;
    left: 18px;
    z-index: 2100;
    background: #1976d2;
    border: none;
    color: #fff;
    font-size: 1.5rem;
    border-radius: 0.375rem;
    padding: 0.25rem 0.5rem;
    display: none;
  }
  
  .back-btn {
    position: fixed;
    top: 18px;
    right: 18px;
    z-index: 2100;
    background: #6c757d;
    border: none;
    color: #fff;
    font-size: 1.2rem;
    border-radius: 0.375rem;
    padding: 0.4rem 0.6rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  
  .back-btn:hover {
    background: #5a6268;
    transform: translateX(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  @media (max-width: 991.98px) {
    .sidebar {
      position: fixed;
      width: 280px;
      height: 100vh;
      border-right: 1px solid #1565c0;
      left: 0;
      top: 0;
      background: #1976d2;
      transform: translateX(-100%);
      z-index: 2000;
    }
    .sidebar.show {
      transform: translateX(0);
    }
    .sidebar.collapsed {
      width: 60px;
    }
    .main-content {
      margin-left: 0;
      padding: 1rem;
    }
    .main-content.full {
      margin-left: 0;
    }
    .hamburger {
      display: block;
    }
    body.sidebar-open {
      overflow: hidden;
    }
  }
</style>
<button class="hamburger" id="sidebarToggle" aria-label="Toggle sidebar">
  <i class="bi bi-list"></i>
</button>
<button class="back-btn" id="backButton" aria-label="Go back" onclick="history.back()">
  <i class="bi bi-arrow-left"></i>
</button>
<div class="sidebar" id="sidebar">
  <div class="sidebar-header text-center mb-4" style="color: #fff;">
    <div class="fs-4 fw-bold">Canteen Management</div>
    <div class="fs-4 fw-bold">System</div>
    <div class="text-muted small mt-2" style="color: #fff !important;">Current User : {{ current_user.name }}</div>
  </div>
  <ul class="nav flex-column">
    {% if current_user.role == 'Admin' %}
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.dashboard') }}"><span class="menu-icon"><i class="bi bi-speedometer2"></i></span><span class="menu-label">Dashboard</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.add_user') }}"><span class="menu-icon"><i class="bi bi-person-plus"></i></span><span class="menu-label">Add User</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.employee_reports') }}"><span class="menu-icon"><i class="bi bi-people"></i></span><span class="menu-label">Employee Reports</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.dept_location_reports') }}"><span class="menu-icon"><i class="bi bi-building"></i></span><span class="menu-label">Dept/Location Reports</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.cost_subsidy') }}"><span class="menu-icon"><i class="bi bi-cash-coin"></i></span><span class="menu-label">Cost & Subsidy</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.vendor_report') }}"><span class="menu-icon"><i class="bi bi-truck"></i></span><span class="menu-label">Vendor Report</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('admin.export') }}"><span class="menu-icon"><i class="bi bi-file-earmark-arrow-down"></i></span><span class="menu-label">Export</span></a></li>
      <li class="nav-item mt-2"><a class="nav-link d-flex align-items-center text-danger" href="{{ url_for('admin.logout') }}"><span class="menu-icon"><i class="bi bi-box-arrow-right"></i></span><span class="menu-label">Logout</span></a></li>
    {% elif current_user.role == 'Employee' %}
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('employee.dashboard') }}"><span class="menu-icon"><i class="bi bi-speedometer2"></i></span><span class="menu-label">Dashboard</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('employee.booking_history') }}"><span class="menu-icon"><i class="bi bi-journal-text"></i></span><span class="menu-label">My Bookings</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('employee.profile') }}"><span class="menu-icon"><i class="bi bi-person"></i></span><span class="menu-label">Profile</span></a></li>
      <li class="nav-item mt-2"><a class="nav-link d-flex align-items-center text-danger" href="{{ url_for('employee.logout') }}"><span class="menu-icon"><i class="bi bi-box-arrow-right"></i></span><span class="menu-label">Logout</span></a></li>
    {% elif current_user.role in ['Staff', 'Supervisor'] %}
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('staff.dashboard') }}"><span class="menu-icon"><i class="bi bi-speedometer2"></i></span><span class="menu-label">Dashboard</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('staff.qr_scanner') }}"><span class="menu-icon"><i class="bi bi-upc-scan"></i></span><span class="menu-label">QR Scanner</span></a></li>
      <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('staff.summary') }}"><span class="menu-icon"><i class="bi bi-clipboard-data"></i></span><span class="menu-label">Daily Summary</span></a></li>
      {% if current_user.role == 'Supervisor' %}
        <li class="nav-item"><a class="nav-link d-flex align-items-center" href="{{ url_for('staff.manage_roles') }}"><span class="menu-icon"><i class="bi bi-person-gear"></i></span><span class="menu-label">Role Management</span></a></li>
      {% endif %}
      <li class="nav-item mt-2"><a class="nav-link d-flex align-items-center text-danger" href="{{ url_for('staff.logout') }}"><span class="menu-icon"><i class="bi bi-box-arrow-right"></i></span><span class="menu-label">Logout</span></a></li>
    {% endif %}
  </ul>
</div>
<main class="main-content d-flex justify-content-center align-items-center" id="mainContent" style="min-height: 80vh;">
  {% block main_content %}{% endblock %}
</main>
<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<script>
  const sidebar = document.getElementById('sidebar');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const mainContent = document.getElementById('mainContent');
  function toggleSidebar() {
    if (window.innerWidth <= 991.98) {
      sidebar.classList.toggle('show');
      document.body.classList.toggle('sidebar-open');
      mainContent.classList.toggle('full');
    } else {
      sidebar.classList.toggle('collapsed');
      mainContent.classList.toggle('full');
    }
  }
  sidebarToggle.addEventListener('click', toggleSidebar);
  // Close sidebar when clicking outside on mobile
  document.addEventListener('click', function(event) {
    if (window.innerWidth <= 991.98 && sidebar.classList.contains('show')) {
      if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
        sidebar.classList.remove('show');
        document.body.classList.remove('sidebar-open');
        mainContent.classList.remove('full');
      }
    }
  });
  // Hide sidebar by default on mobile
  window.addEventListener('DOMContentLoaded', function() {
    if (window.innerWidth <= 991.98) {
      sidebar.classList.remove('show');
      mainContent.classList.add('full');
    }
  });
</script>
{% endblock %} 